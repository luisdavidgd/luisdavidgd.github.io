---
import Button from "@components/ui/button/Button.astro";
import Modal from "@components/ui/modal/Modal.astro";
---

<Modal id="contactModal" title="Contact Me">
  <form id="contactForm">
    <div class="field">
      <label for="name">Name</label>
      <input id="name" name="name" type="text" required />
    </div>

    <div class="field">
      <label for="email">Email</label>
      <input id="email" name="email" type="email" required />
    </div>

    <div class="field">
      <label for="message">Message</label>
      <textarea id="message" name="message" rows="4" required></textarea>
    </div>

    <div class="actions">
      <Button id="cancelBtn" type="button" variant="secondary" size="sm">
        Cancel
      </Button>
      <Button type="submit" variant="primary" size="sm"> Send </Button>
    </div>
  </form>
</Modal>

<style>
  .field {
    margin-bottom: 1rem;
  }
  .field label {
    display: block;
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
    color: var(--text-color);
  }
  .field input,
  .field textarea {
    width: 100%;
    border: 1px solid var(--accent);
    border-radius: 0.25rem;
    padding: 0.5rem;
  }
  .actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
  }
</style>

<script is:client="load">
  const form = document.getElementById("contactForm");
  const cancelBtn = document.getElementById("cancelBtn");
  const modal = document.getElementById("contactModal");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(form).entries());

    try {
      const res = await fetch(
        "https://formsubmit.co/ajax/5f3fa84dbca4fa06d3ae082dcc54673a",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify(data),
        },
      );

      if (!res.ok) throw new Error("Error sending");

      console.log("Message sent âœ…");
      alert("Thank you, your message was sent.");

      modal.classList.add("hidden"); // cerrar modal
      form.reset();
    } catch (err) {
      console.error(err);
      alert("There was a problem sending the message.");
    }
  });

  cancelBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
  });
</script>
