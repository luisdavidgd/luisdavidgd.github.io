---
const year = new Date().getFullYear();
import contactIconRaw from "../../assets/icons/contact-icon.svg?raw";
import Button from "../ui/button/Button.astro";

function sanitizeToWhite(svg: string, size = 18) {
  let s = svg
    .replace(/<\?xml[\s\S]*?\?>/g, "")
    .replace(/<!--([\s\S]*?)-->/g, "")
    .replace(/width=\"[^\"]*\"/g, "")
    .replace(/height=\"[^\"]*\"/g, "")
    .replace(/fill=\"[^\"]*\"/gi, 'fill="currentColor"')
    .replace(/stroke=\"[^\"]*\"/gi, 'stroke="none"');
  s = s.replace(
    /<svg([^>]*)>/,
    (m, attrs) => `<svg${attrs} width="${size}" height="${size}">`,
  );
  return s;
}

const contactIcon = sanitizeToWhite(contactIconRaw);
const feedUrl = new URL("rss.xml", Astro.site).toString();
// const feedlyUrl = `https://feedly.com/i/subscription/feed/${feedUrl}`;
const instagramUrl = `https://instagram.com/luisdavidgd`;
const gitHubUrl = `https://github.com/luisdavidgd`;
---

<footer id="contact" class="site-footer">
  <h2 class="footer-title">Want to work with me?</h2>
  <p class="footer-subtitle">Let's build something together!</p>

  <div class="footer-cta">
    <Button type="button" variant="secondary" size="md" data-getInTouch>
      <span class="icon" aria-hidden="true" set:html={contactIcon} />
      Get in touch
    </Button>
  </div>

  <div class="footer-links">
    <a
      class="btn-sm"
      href={gitHubUrl}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Look at my Github">Github</a
    >
    <button
      class="btn-sm"
      type="button"
      data-copy={feedUrl}
      aria-label="Copy RSS link">Copy RSS link</button
    >
    <a class="btn-sm" href="/blog/" aria-label="Browse all posts">All posts</a>
  </div>

  <div class="footer-credit">
    Copyright &copy; {year} Luis David Gallo Dawson.
  </div>

  <script type="module">
    const copyRSSLinkBtn = document.querySelector("button[data-copy]");
    const getInTouchBtn = document.querySelector("button[data-getInTouch]");

    copyRSSLinkBtn?.addEventListener("click", (e) => {
      const target = e.target;
      if (!(target instanceof HTMLElement)) return;
      if (target.matches("button[data-copy]")) {
        const url = target.getAttribute("data-copy");
        if (!url) return;
        navigator.clipboard?.writeText(url);
        const original = target.textContent || "Copy RSS link";
        target.textContent = "Copied!";
        setTimeout(() => {
          target.textContent = original;
        }, 1500);
      }
    });

    getInTouchBtn?.addEventListener("click", (e) => {
      console.log("Please open a modal to contact me.");
    });
  </script>
</footer>

<style>
  .site-footer {
    padding: 3rem 1rem;
    text-align: center;
  }

  .footer-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-text-primary);
  }
  @media (min-width: 768px) {
    .footer-title {
      font-size: 1.875rem;
    }
  }

  .footer-subtitle {
    margin-top: 0.5rem;
    color: var(--color-text-muted);
  }

  .footer-cta {
    margin-top: 1.5rem;
    display: flex;
    justify-content: center;
  }
  .footer-cta .icon {
    display: inline-flex;
    margin-right: 0.5rem;
  }

  .footer-credit {
    margin-top: 1.5rem;
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }
  .footer-credit a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  .footer-credit a:hover {
    color: var(--accent);
  }

  .footer-links {
    margin-top: 1.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing);
    font-size: 0.875rem;
  }

  .btn-sm {
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    border: 1px solid var(--border);
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
    text-decoration: none;
    cursor: pointer;
    transition:
      background 0.2s ease,
      color 0.2s ease;
  }
  .btn-sm:hover {
    background: var(--accent);
    color: white;
  }
  .btn-sm[disabled],
  .btn-sm[aria-disabled="true"] {
    opacity: 0.5;
    pointer-events: none;
  }
</style>
