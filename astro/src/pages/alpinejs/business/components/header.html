<nav class="fixed top-0 left-0 w-full z-50 bg-white shadow" x-data="navbar" x-init="observeSections()">
  <div class="max-w-6xl mx-auto w-full flex items-center justify-between px-4 py-3">
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <img src="assets/img/100x100.jpg" alt="Business Logo" class="h-10 w-10" />
      <a href="#top" class="text-xl font-bold">Business Website</a>
    </div>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex space-x-4">
      <template x-for="(item, index) in menu" :key="index">
        <li>
          <a :href="item.href" :class="activeSection === item.href
              ? 'text-blue-600 font-semibold underline'
              : 'text-gray-700 hover:text-blue-600'" class="capitalize transition" x-text="item.name"
            @click.prevent="scrollTo(item.href)"></a>
        </li>
      </template>
    </ul>

    <!-- Burger -->
    <div class="md:hidden">
      <button class="text-gray-700 hover:text-blue-600 focus:outline-none" @click="open = !open" aria-label="Menú">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div x-show="open" x-transition class="md:hidden px-4 pb-4" @click.outside="open = false">
    <ul class="flex flex-col space-y-2 bg-white shadow rounded-lg p-4">
      <template x-for="(item, index) in menu" :key="index">
        <li>
          <a :href="item.href" :class="activeSection === item.href
              ? 'text-blue-600 font-semibold underline'
              : 'text-gray-700 hover:text-blue-600'" class="capitalize transition block" x-text="item.name"
            @click.prevent="scrollTo(item.href)"></a>
        </li>
      </template>
    </ul>
  </div>
</nav>

<script>
  function navbar() {
    return {
      open: false,
      activeSection: "#top",
      menu: [
        // { name: "home", href: "#top" },
        { name: "about", href: "#about" },
        { name: "services", href: "#services" },
        { name: "schedule", href: "#schedule" },
        { name: "contact", href: "#contact" },
      ],

      scrollTo(hash) {
        const target = document.querySelector(hash);
        if (target) {
          window.scrollTo({
            top: target.offsetTop - 80, // Ajusta según altura de navbar
            behavior: "smooth"
          });
          this.activeSection = hash;
          window.history.replaceState(null, null, hash);
          this.open = false;
        }
      },

      observeSections() {
        const options = {
          root: null,
          rootMargin: "0px",
          threshold: 0.6, // cuando el 60% esté visible
        };

        const callback = (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              this.activeSection = "#" + entry.target.id;
              window.history.replaceState(null, null, this.activeSection);
            }
          });
        };

        const observer = new IntersectionObserver(callback, options);

        this.menu.forEach(({ href }) => {
          const id = href.replace("#", "");
          const el = document.getElementById(id);
          if (el) observer.observe(el);
        });
      }
    };
  }
</script>