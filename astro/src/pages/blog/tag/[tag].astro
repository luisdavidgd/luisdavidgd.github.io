---
import { getCollection } from "astro:content";
import LandingPage from "@layouts/LandingPage.astro";
import PostCard from "@components/ui/card/PostCard.astro";
import { slugifyTag } from "@lib/slug";
import { getTagMeta } from "../../../data/tags";
import HeroSection from "@components/sections/HeroSection.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = [...new Set(posts.flatMap((p) => p.data.tags || []))];
  return tags.map((tag: any) => ({ params: { tag: slugifyTag(tag) } }));
}

const { tag } = Astro.params;
const posts = (await getCollection("blog")).filter((p) =>
  (p.data.tags || []).some((t) => slugifyTag(t) === tag),
);
const meta = getTagMeta(tag);
---

<LandingPage>
  <HeroSection
    title=`Posts tagged with ${tag}`
    subtitle="This is where I will post about my journey learning Astro."
  />
  <section>
    <div class="container">
      <div class="grid">
        {posts.map((p) => <PostCard post={p} />)}
      </div>
    </div>
  </section>
</LandingPage>
