---
import { getCollection } from "astro:content";
import LandingPage from "@layouts/LandingPage.astro";
import HeroSection from "@components/sections/HeroSection.astro";
import CheatSheetList from "@components/sections/CheatSheetList.astro";
import Pagination from "@components/ui/nav/Pagination.astro";

export async function getStaticPaths() {
  const PAGE_SIZE = 6;
  const sheets = (await getCollection("cheatsheets")).sort(
    (a, b) => +b.data.pubDate - +a.data.pubDate,
  );
  const totalPages = Math.max(1, Math.ceil(sheets.length / PAGE_SIZE));
  return Array.from({ length: totalPages - 1 }, (_, i) => ({
    params: { page: String(i + 2) },
  }));
}

const PAGE_SIZE = 6;
const sheets = (await getCollection("cheatsheets")).sort(
  (a, b) => +b.data.pubDate - +a.data.pubDate,
);
const { page } = Astro.params;
const currentPage = Math.max(1, parseInt(page || "1", 10));
const start = (currentPage - 1) * PAGE_SIZE;
const end = start + PAGE_SIZE;
const pageSheets = sheets.slice(start, end);
const totalPages = Math.max(1, Math.ceil(sheets.length / PAGE_SIZE));
const title = "Cheat Sheets!";
---

<LandingPage>
  <HeroSection
    {title}
    subtitle="This is where I will post about my journey learning Astro."
  />
  <CheatSheetList sheets={pageSheets} />
  <Pagination
    currentPage={currentPage}
    totalPages={totalPages}
    rootPath="/cheatsheets/"
    basePath="/cheatsheets/page"
    prevLabel="← Back"
    nextLabel="Next →"
  />
</LandingPage>
